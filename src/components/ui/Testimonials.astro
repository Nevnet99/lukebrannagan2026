---
import { FileText, FolderOpen } from "@lucide/astro";
import SectionHeading from "../SectionHeading.astro";
import PageSection from "../Structure/PageSection.astro";
import Avatar from "../ds/Avatar.astro";

const testimonials = [
  {
    id: "andrew",
    filename: "andrew_gy.md",
    author: "Andrew Graham-Yooll",
    role: "Tech Lead / EM - Primer",
    content:
      "As someone with a product oriented mindset and great skills as a Frontend Engineer, Luke is a guy that I would want supporting me and my team any day.\n\nFrom the first day he was on my team, Luke brought new ideas and ways of working that pushed our product to new levels. He challenged the way we were building our Design System and proposed a quicker and more efficient way of meeting out KPIs.\n\nWithin a very short amount of time, he was contributing to the design, look and feel of the product he was developing, demonstrating ownership at every turn. As a team lead, it's refreshing when someone comes in with an opinion and is able to communicate it effectively. And Luke certainly achieved that.\n\nLuke will be missed on my team. And any team that is able to work with him, should consider themselves fortunate.",
  },
  {
    id: "jake",
    filename: "jake_smith.md",
    author: "Jake Smith",
    role: "Head of Frontend - DEPT",
    content:
      "I can't write enough good words about Luke. He joined Dept in a junior position, but with a thirst for knowledge, a can do attitude and great demeanor. All three improved constantly during his time at Dept.\n\nArticulate, assertive and very immersed in web development, Luke's absorption of frameworks and speed to pick new things up astonishes me. His understanding of business requirements vs code approach improved a lot whilst working with the teams and I, and this has improved his decision making and the maturity of his code.\n\nHe's also a talented musician and fun to spend time with, not fair, is it? Some people get it all!",
  },
  {
    id: "rick",
    filename: "rick_thompson.md",
    author: "Rick Thompson",
    role: "Senior Frontend Engineer - DEPT",
    content:
      "Luke is an amazing senior developer, who always strives to learn more for the better of the team and himself. Very good communication skills and very open to change.\n\nHe picks up new skills and is a dedicated developer to project, enforcing best practices and implementing changes when issues arise. An asset to any team! Also great personality and very approachable :)",
  },
];
---

<PageSection>
  <SectionHeading>testimonials</SectionHeading>

  <div
    class="flex flex-col md:flex-row border border-text/20 bg-background rounded-sm h-auto min-h-[400px]"
  >
    <div
      class="w-full md:w-64 border-b md:border-b-0 md:border-r border-text/10 bg-text/5 flex flex-col flex-shrink-0"
    >
      <div
        class="px-4 py-3 border-b border-text/10 text-xs font-bold text-text/40 uppercase tracking-widest flex items-center gap-2"
      >
        <FolderOpen size={14} />
        Explorer
      </div>

      <div
        class="flex flex-row md:flex-col overflow-x-auto md:overflow-x-visible"
      >
        {
          testimonials.map((t, index) => (
            <button
              class="testimonial-tab group w-full flex items-center gap-3 px-4 py-3 text-sm transition-all border-l-2 text-left  text-text/60 border-transparent hover:bg-text/5 hover:text-text hover:border-green-400/50 aria-selected:bg-text/5 aria-selected:text-text aria-selected:border-green-400"
              data-target={t.id}
              aria-selected={index === 0 ? "true" : "false"}
              aria-label={`View testimonial from ${t.author}`}
            >
              <FileText
                size={14}
                class="opacity-50 group-hover:text-green-400 group-aria-selected:text-green-400 transition-colors"
              />
              <span class="truncate">{t.filename}</span>
            </button>
          ))
        }
      </div>
    </div>

    <div class="flex-1 relative bg-background">
      {
        testimonials.map((t, index) => (
          <div
            id={t.id}
            class={`testimonial-content p-6 md:p-10 ${index === 0 ? "block animate-fade-in" : "hidden"}`}
          >
            <div class="flex items-center gap-2 text-xs text-text/30 mb-8 font-mono">
              <span>src</span>
              <span>/</span>
              <span>reviews</span>
              <span>/</span>
              <span class="text-text/60">{t.filename}</span>
            </div>

            {/* Author Header */}
            <div class="flex items-center gap-4 mb-8">
              <Avatar />
              <div>
                <h3 class="text-lg font-bold text-text/90">{t.author}</h3>
                <p class="text-xs text-text/50 uppercase tracking-wider">
                  {t.role}
                </p>
              </div>
            </div>

            <div class="prose prose-invert prose-p:text-text/70 prose-p:leading-loose prose-p:font-mono max-w-none">
              {t.content.split("\n\n").map((paragraph) => (
                <p class="mb-4">{paragraph}</p>
              ))}
            </div>
          </div>
        ))
      }
    </div>
  </div>
</PageSection>

<script>
  function setupTabs() {
    const tabs = document.querySelectorAll(".testimonial-tab");
    const contents = document.querySelectorAll(".testimonial-content");

    const setActive = (targetId: string) => {
      // Toggle Tabs
      tabs.forEach((tab) => {
        const isTarget = tab.getAttribute("data-target") === targetId;
        tab.setAttribute("aria-selected", isTarget ? "true" : "false");
      });

      // Toggle Content
      contents.forEach((content) => {
        if (content.id === targetId) {
          content.classList.remove("hidden");
          content.classList.add("block", "animate-fade-in");
        } else {
          content.classList.remove("block", "animate-fade-in");
          content.classList.add("hidden");
        }
      });
    };

    tabs.forEach((tab) => {
      tab.addEventListener("click", () => {
        const target = tab.getAttribute("data-target");
        if (target) setActive(target);
      });
    });
  }

  document.addEventListener("astro:page-load", setupTabs);

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", setupTabs);
  } else {
    setupTabs();
  }
</script>

<style>
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(5px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  .animate-fade-in {
    animation: fadeIn 0.3s ease-out forwards;
  }
</style>
